<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whack-a-Mole</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        body {
            /* Applied the new round font */
            font-family: 'Fredoka One', cursive;
            touch-action: manipulation; /* Prevents double-tap zoom on mobile */
        }
        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 400px;
            /* Custom hammer cursor - now bigger! */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="72" height="72" viewBox="0 0 24 24"><g transform="rotate(45 12 12)"><rect x="8" y="2" width="8" height="4" rx="1" fill="%23A0522D"/><rect x="11" y="6" width="2" height="16" rx="1" fill="%23DEB887"/></g></svg>') 18 18, auto;
        }
        .game-grid:active {
            /* Rotated hammer on click to simulate a swing - also bigger! */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="72" height="72" viewBox="0 0 24 24"><g transform="rotate(65 12 12)"><rect x="8" y="2" width="8" height="4" rx="1" fill="%23A0522D"/><rect x="11" y="6" width="2" height="16" rx="1" fill="%23DEB887"/></g></svg>') 18 18, auto;
        }
        .hole {
            width: 100%;
            aspect-ratio: 1 / 1;
            background-color: #A0522D; /* SaddleBrown */
            border-radius: 50%;
            border: 5px solid #8B4513; /* Darker SaddleBrown */
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 10px 10px rgba(0,0,0,0.4);
            transition: all 0.2s ease;
        }
        .hole:active {
            transform: scale(0.95);
        }
        .mole {
            width: 75%;
            height: 75%;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%238B572A"/><circle cx="35" cy="40" r="5" fill="black"/><circle cx="65" cy="40" r="5" fill="black"/><ellipse cx="50" cy="60" rx="15" ry="8" fill="%23F5DEB3"/><path d="M40 70 Q50 80 60 70" stroke="black" fill="none" stroke-width="3"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom;
            transition: transform 0.2s ease-out;
            pointer-events: none; /* Mole itself is not clickable, only the hole */
        }
        .hole.up .mole {
            transform: translateX(-50%) translateY(0%);
        }
        .whacked .mole {
             transform: translateX(-50%) translateY(100%) rotate(30deg);
             transition: transform 0.1s ease-in;
        }
    </style>
</head>
<body class="bg-green-400 flex flex-col items-center justify-center min-h-screen p-4 text-gray-800">

    <div class="w-full max-w-md bg-green-600 p-6 rounded-2xl shadow-2xl border-8 border-green-800 text-center">
        <h1 class="text-6xl text-yellow-300 tracking-wider text-shadow-lg" style="text-shadow: 4px 4px 0px rgba(0,0,0,0.2);">Whack-a-Mole!</h1>

        <div class="flex justify-around my-6 text-4xl text-white">
            <div>
                <h2>Score: <span id="score" class="text-yellow-300">0</span></h2>
            </div>
            <div>
                <h2>Time: <span id="time-left" class="text-yellow-300">30</span></h2>
            </div>
        </div>

        <div id="game-grid" class="game-grid mx-auto mb-6">
            </div>

        <button id="start-button" class="bg-red-500 hover:bg-red-600 text-white text-4xl py-3 px-10 rounded-lg shadow-lg border-b-8 border-red-700 active:border-b-2 active:translate-y-1 transition-all duration-100 ease-in-out">
            Start Game
        </button>
        
        <div id="game-over-message" class="hidden text-5xl text-red-500 mt-4" style="text-shadow: 2px 2px 0px #FFF;"></div>

    </div>

    <script>
        // --- DOM Elements ---
        const gameGrid = document.getElementById('game-grid');
        const scoreDisplay = document.getElementById('score');
        const timeLeftDisplay = document.getElementById('time-left');
        const startButton = document.getElementById('start-button');
        const gameOverMessage = document.getElementById('game-over-message');

        // --- Game State Variables ---
        let holes = [];
        let score = 0;
        let timeLeft = 30;
        let moleAppearanceTimer = null;
        let countdownTimer = null;
        let lastHoleIndex = -1;
        let isGameRunning = false;
        
        // --- Sound Synthesis ---
        // Create a simple synth for sound effects to avoid external file dependencies
        const synth = new Tone.Synth({
            oscillator: { type: 'square' },
            envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.1 }
        }).toDestination();
        
        const hitSound = () => synth.triggerAttackRelease('C4', '8n');
        const missSound = () => {
            const missSynth = new Tone.Synth({
                oscillator: { type: 'sine' },
                envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.2 }
            }).toDestination();
            missSynth.triggerAttackRelease('A2', '16n', Tone.now(), 0.5);
        };


        // --- Game Initialization ---
        function createGameBoard() {
            // Create 9 holes for the game grid
            for (let i = 0; i < 9; i++) {
                const hole = document.createElement('div');
                hole.classList.add('hole');
                hole.dataset.index = i; // Store index for tracking

                const mole = document.createElement('div');
                mole.classList.add('mole');
                
                hole.appendChild(mole);
                gameGrid.appendChild(hole);
                holes.push(hole);
            }
        }

        // --- Game Logic ---
        function startGame() {
            if (isGameRunning) return; // Prevent starting multiple times
            isGameRunning = true;
            
            // Reset game state
            score = 0;
            timeLeft = 30;
            scoreDisplay.textContent = score;
            timeLeftDisplay.textContent = timeLeft;
            gameOverMessage.classList.add('hidden');
            startButton.classList.add('hidden');
            
            // Start the game loops
            moleAppearanceTimer = setInterval(showRandomMole, 800); // A mole appears every 800ms
            countdownTimer = setInterval(countdown, 1000); // Timer counts down every second
        }

        function endGame() {
            isGameRunning = false;
            
            // Stop game loops
            clearInterval(moleAppearanceTimer);
            clearInterval(countdownTimer);
            
            // Display final message and show start button
            gameOverMessage.textContent = `Game Over! Final Score: ${score}`;
            gameOverMessage.classList.remove('hidden');
            startButton.classList.remove('hidden');
            startButton.textContent = 'Play Again?';

            // Hide any remaining moles
            holes.forEach(hole => hole.classList.remove('up', 'whacked'));
        }

        function countdown() {
            timeLeft--;
            timeLeftDisplay.textContent = timeLeft;
            if (timeLeft <= 0) {
                endGame();
            }
        }

        function showRandomMole() {
            // Hide previous mole if it's still up
            holes.forEach(hole => hole.classList.remove('up'));

            // Get a new random hole that is different from the last one
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * holes.length);
            } while (randomIndex === lastHoleIndex);
            
            lastHoleIndex = randomIndex;
            const randomHole = holes[randomIndex];
            
            // Make the mole appear
            randomHole.classList.add('up');

            // Set a timer to make the mole disappear after a random duration
            const randomTime = Math.random() * (1000 - 400) + 400; // between 400ms and 1000ms
            setTimeout(() => {
                if (!randomHole.classList.contains('whacked')) {
                    randomHole.classList.remove('up');
                }
            }, randomTime);
        }

        function whack(e) {
            if (!isGameRunning) return;

            const hole = e.target.closest('.hole');
            if (!hole) { // Clicked on grid gap, not a hole
                missSound();
                return;
            }

            // Check if a mole was in the hole and it wasn't already whacked
            if (hole.classList.contains('up') && !hole.classList.contains('whacked')) {
                // It's a hit!
                hitSound();
                score++;
                scoreDisplay.textContent = score;
                
                // Add whacked class for visual feedback and prevent multiple scores
                hole.classList.add('whacked');
                
                // Quickly hide the mole after it's whacked
                setTimeout(() => {
                    hole.classList.remove('up', 'whacked');
                }, 200);
            } else {
                // It's a miss!
                missSound();
            }
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);
        gameGrid.addEventListener('mousedown', whack); // Use mousedown for faster response than click

        // --- Initial Setup ---
        window.onload = () => {
            createGameBoard();
        };
    </script>
</body>
</html>
